# AI助手智能报表WEB接口说明

## 思路

### 接口鉴权

接口中接收 **RequestParam** 参数 **UID** ，包含 **会话ID** 与 **会话鉴权码** 。接口需要对会话进行鉴权，鉴权成功才进行后续处理。

### 会话存储

#### 报表数据

报表分析的原始数据，每个报表只保存一份，后上传的数据替换原数据。数据保存到Redis中，以会话ID为Key。

#### 对话历史

对话历史暂时保存在 **SQLite** 中，后期可能迁移到 **ElasticSearch** （个人认为 **MongoDB** 更合适）。

对话历史保存内容：

- 会话ID
- 时间
- 消息类型（用户，或DeepSeek）
- 对话内容
- DeepSeek会话ID

#### 报表分析

接收到前端发来的用户的报表分析请求后，接口从Redis查找用户提交的报表数据，添加系统Prompts，提交到DeepSeek，接收DeepSeek响应，转换格式为HTML，返回给前端。

## 接口汇总

|URI|HTTP方法|说明|
|---|---|---|
|/api/report/data|POST|智能报表数据接口|
|/api/openai/chat/deepseek-chat|POST|智能报表分析接口|

## 接口详细说明

### 智能报表数据接口

### 智能报表分析接口



## 彭总的需求文档内容

### 一 需求描述

根据页面表格数据，自动生成智能报表和解读。

### 二 解决方案

#### 页面表定义，增加以下字段

|字段|说明|
|---|---|
|AI_Report|char(1)，AI智能报表：Y-启用，N-禁用|

#### 启用AI智能报表时，页面右上角自动添加AI报表图标

1. 点击报表，弹出AI对话框。
2. 自动获取本页面显示数据，并自动提交到华微世纪AI报表接口

#### AI报表接口要求

1. 接口需要有安全验证
2. 需要自动记录上下文件
3. 首次进入时，自动提交页面数据

### 三 开发文档

#### 扩充后台show方法

1. 生成带中文列名的JSON数据
2. 限制最大数据行数
3. 不包括合计行数据

#### 启用AI报表时，Hw_PageSize控件，附加上AI报表标识

#### AI后台

1. AiReport.ashx?UID=52ae3847-98a8-4128-aa0b-7105ef292b26
2. 首次：PostData=GRID数据
3. 后面为用户输入的内容，Post提交

#### JS处理

1. 从后台获取UID数据
2. 调用show方法，获取GRID数据
3. 打开AI对话框
4. 自动提交GRID数据
5. 接收AI返回的数据并显示
6. 用户输入后，再提交，再显示返回结果
